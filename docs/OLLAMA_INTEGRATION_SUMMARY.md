# Ollama Embeddings Integration - Summary

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç OllamaEmbeddings
- **–§–∞–π–ª**: `src/core/integrations/ai/embeddings/ollama.py`
- **–ö–ª–∞—Å—Å**: `OllamaEmbeddings(BaseEmbeddings)`
- **–§—É–Ω–∫—Ü–∏–∏**:
  - `embed(texts)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤
  - `embed_query(text)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embedding –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
  - `check_health()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
  - `get_dimensions()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤–µ–∫—Ç–æ—Ä–æ–≤

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (.env)
–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
OLLAMA_EMBEDDINGS_BASE_URL=http://your-ollama-server.com/ollama
OLLAMA_EMBEDDINGS_API_KEY=your_api_key_here
OLLAMA_EMBEDDING_MODEL=mxbai-embed-large  # –∏–ª–∏ nomic-embed-text
OLLAMA_EMBEDDING_DIMENSIONS=1024          # 1024 –¥–ª—è mxbai, 768 –¥–ª—è nomic
USE_OLLAMA_EMBEDDINGS=True                # –§–ª–∞–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```

### 3. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `OPENROUTER_EMBEDDING_MODEL=None` (deprecated)
- –°—Ç–∞—Ä—ã–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ù–æ–≤—ã–π –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `USE_OLLAMA_EMBEDDINGS` –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **Quick Start**: `docs/OLLAMA_EMBEDDINGS_QUICK_START.md`
- **–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç**: `scripts/test_ollama_embeddings.py`
- **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | –†–∞–∑–º–µ—Ä | –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ö–∞—á–µ—Å—Ç–≤–æ |
|--------|--------|-------------|----------|----------|
| **mxbai-embed-large** | 669 MB | 1024 | –°—Ä–µ–¥–Ω—è—è | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **nomic-embed-text** | 274 MB | 768 | –ë—ã—Å—Ç—Ä–∞—è | ‚≠ê‚≠ê‚≠ê‚≠ê |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (–æ–±–∞ –º–æ–¥–µ–ª–∏ + —Å—Ö–æ–¥—Å—Ç–≤–æ)
uv run python scripts/test_ollama_embeddings.py
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ
```python
from src.core.integrations.ai.embeddings import OllamaEmbeddings

async with OllamaEmbeddings() as embedder:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    if not await embedder.check_health():
        print("Ollama –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!")
        return

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings
    vector = await embedder.embed_query("–≤–∞—à —Ç–µ–∫—Å—Ç")
    print(f"–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: {len(vector)}")  # 1024
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –¶–µ–Ω–∞ | –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å | –õ–æ–∫–∞—Ü–∏—è | –ö–∞—á–µ—Å—Ç–≤–æ |
|-----------|------|-------------|---------|----------|
| **Ollama** | üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | 1024 | –õ–æ–∫–∞–ª—å–Ω–æ | ‚≠ê‚≠ê‚≠ê‚≠ê |
| OpenAI | $0.02 / 1M tok | 1536 | –û–±–ª–∞–∫–æ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Local (sentence-transformers) | üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | 384 | –õ–æ–∫–∞–ª—å–Ω–æ | ‚≠ê‚≠ê‚≠ê |
| OpenRouter | ‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è | - | - | - |

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

–í `.env` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

```bash
# 1Ô∏è‚É£ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: Ollama (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
USE_OLLAMA_EMBEDDINGS=True

# 2Ô∏è‚É£ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: OpenAI (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á)
OPENAI_EMBEDDINGS_API_KEY=sk-xxx

# 3Ô∏è‚É£ Fallback: Local sentence-transformers
USE_LOCAL_EMBEDDINGS=False
```

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `scripts/test_ollama_embeddings.py` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞ (`check_health()`)
2. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—é embedding –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
3. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—é embeddings –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
4. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤–µ–∫—Ç–æ—Ä–æ–≤
5. ‚úÖ –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
6. ‚úÖ –û–±–µ –º–æ–¥–µ–ª–∏ (mxbai + nomic)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–µ—Å—Ç–∞:**
```
‚úÖ Ollama —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω: http://ai.equiply.ru/ollama
‚úÖ mxbai-embed-large: 1024 dimensions
‚úÖ nomic-embed-text: 768 dimensions
‚úÖ –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (0.72-0.77)
```

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. AttributeError: 'OllamaEmbeddings' object has no attribute 'client'
**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ø—ã—Ç–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ `self.client` –≤–º–µ—Å—Ç–æ `self._get_client()`

**–†–µ—à–µ–Ω–∏–µ**:
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω `_get_headers()` –¥–ª—è X-Api-Key
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `self._get_client()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è HTTP –∫–ª–∏–µ–Ω—Ç–∞

### 2. Missing OPENROUTER_EMBEDDING_MODEL attribute
**–ü—Ä–∏—á–∏–Ω–∞**: –£–¥–∞–ª–µ–Ω –∞—Ç—Ä–∏–±—É—Ç –≤ Session 4 Part 1, –Ω–æ —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞—Ç–Ω–æ —Å `None` –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏ –ø–æ–º–µ—Ç–∫–æ–π deprecated

### 3. CORS errors (https://equiply.ru ‚Üí https://api.equiply.ru)
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `https://api.equiply.ru` –≤ `ALLOW_ORIGINS`

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
1. `src/core/integrations/ai/embeddings/ollama.py` - –∫–ª–∏–µ–Ω—Ç
2. `scripts/test_ollama_embeddings.py` - —Ç–µ—Å—Ç—ã
3. `docs/OLLAMA_EMBEDDINGS_QUICK_START.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `src/core/settings/base.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Ollama
2. `src/core/integrations/ai/embeddings/__init__.py` - —ç–∫—Å–ø–æ—Ä—Ç OllamaEmbeddings
3. `.env.example` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. `.env.dev` - dev –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üéì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π Ollama (mxbai-embed-large) –µ—Å–ª–∏:**
- –ù—É–∂–Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
- –†–∞–±–æ—Ç–∞–µ—à—å –ª–æ–∫–∞–ª—å–Ω–æ (dev/test)
- –í–∞–∂–Ω–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
- –ï—Å—Ç—å ‚â•1GB RAM –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π OpenAI –µ—Å–ª–∏:**
- –ö—Ä–∏—Ç–∏—á–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
- Production —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **Quick Start**: `docs/OLLAMA_EMBEDDINGS_QUICK_START.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- **OpenRouter Chat**: `docs/OPENROUTER_QUICK_TEST.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Ç–æ–≤
- **Free Models**: `docs/OPENROUTER_FREE_MODELS.md` - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏
- **Troubleshooting**: `docs/OPENROUTER_TROUBLESHOOTING.md` - —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

## üöÄ Next Steps

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RAG**: –û–±–Ω–æ–≤–∏—Ç—å `src/services/v1/rag_search.py` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Ollama
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å Redis –∫—ç—à –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö embeddings
3. **Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–µ–∫—Å—Ç–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (latency, throughput)
5. **Fallback**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ OpenAI –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Ollama
